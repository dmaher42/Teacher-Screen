<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO and Browser Meta Tags -->
    <meta name="description" content="A customizable classroom management screen with widgets for teachers.">
    <meta name="author" content="Your Name">
    <meta name="theme-color" content="#3498db">

    <title>Custom Classroom Screen</title>

    <!-- Stylesheets -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/themes.css">
    
    <!-- Favicon (placeholder) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“š</text></svg>">
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js" defer></script>
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.min.js" defer></script>
</head>

<!-- Set a default theme class on the body -->
<body class="memory-cue-theme">

    <noscript>
        <div class="noscript-message">
            For full functionality of this site, it is necessary to enable JavaScript.
        </div>
    </noscript>

    <nav id="top-nav" aria-label="Main sections">
        <div class="nav-tabs" role="tablist">
            <button class="nav-tab" role="tab" aria-selected="false" aria-controls="dashboard-view" id="dashboard-tab" data-tab="dashboard">Dashboard</button>
            <button class="nav-tab active" role="tab" aria-selected="true" aria-controls="classroom-view" id="classroom-tab" data-tab="classroom">Classroom</button>
            <button class="nav-tab" role="tab" aria-selected="false" aria-controls="reminders-view" id="reminders-tab" data-tab="reminders">Reminders</button>
            <button class="nav-tab" role="tab" aria-selected="false" aria-controls="planner-view" id="planner-tab" data-tab="planner">Planner</button>
            <button class="nav-tab" role="tab" aria-selected="false" aria-controls="timetable-view" id="timetable-tab" data-tab="timetable">Timetable</button>
            <button class="nav-tab" role="tab" aria-selected="false" aria-controls="notes-view" id="notes-tab" data-tab="notes">Notes</button>
        </div>
        <button id="open-main-menu" class="nav-tab" aria-label="Open main menu" title="Main Menu">
            <i class="fas fa-folder-open" aria-hidden="true"></i>
        </button>
        <button id="open-projector-view" class="nav-tab" style="margin-left: auto;">Open Projector View</button>
    </nav>

    <div id="app-container" class="app-container">
        <!-- =====================================================
             DASHBOARD VIEW (Placeholder)
             ===================================================== -->
        <section id="dashboard-view" class="view" role="tabpanel" aria-labelledby="dashboard-tab" hidden>
            <div class="placeholder-content">Dashboard content coming soon</div>
        </section>

        <!-- =====================================================
             STUDENT VIEW (Classroom)
             ===================================================== -->
        <section id="classroom-view" class="view" role="tabpanel" aria-labelledby="classroom-tab">
            <main id="student-main" class="student-view" role="main" aria-label="Student view">
                <div id="widget-toolbar-wrapper">
                    <div id="widget-selector" class="widget-selector" role="toolbar" aria-label="Widget selector">
                        <button id="timer-widget-btn" class="widget-selector-btn" data-widget="timer" type="button" aria-label="Timer">
                            <i class="fas fa-clock" aria-hidden="true"></i>
                            <span class="visually-hidden">Timer</span>
                        </button>
                        <button id="noise-meter-widget-btn" class="widget-selector-btn" data-widget="noise-meter" type="button" aria-label="Noise meter">
                            <i class="fas fa-volume-high" aria-hidden="true"></i>
                            <span class="visually-hidden">Noise Meter</span>
                        </button>
                        <button id="name-picker-widget-btn" class="widget-selector-btn" data-widget="name-picker" type="button" aria-label="Random name picker">
                            <i class="fas fa-user-check" aria-hidden="true"></i>
                            <span class="visually-hidden">Random Name Picker</span>
                        </button>
                        <button id="qr-code-widget-btn" class="widget-selector-btn" data-widget="qr-code" type="button" aria-label="QR code">
                            <i class="fas fa-qrcode" aria-hidden="true"></i>
                            <span class="visually-hidden">QR Code</span>
                        </button>
                        <button id="drawing-widget-btn" class="widget-selector-btn" data-widget="drawing-tool" type="button" aria-label="Drawing tool">
                            <i class="fas fa-paint-brush" aria-hidden="true"></i>
                            <span class="visually-hidden">Drawing Tool</span>
                        </button>
                        <button id="document-viewer-widget-btn" class="widget-selector-btn" data-widget="document-viewer" type="button" aria-label="Document viewer">
                            <i class="fas fa-file-lines" aria-hidden="true"></i>
                            <span class="visually-hidden">Document Viewer</span>
                        </button>
                        <button id="mask-widget-btn" class="widget-selector-btn" data-widget="mask" type="button" aria-label="Mask widget">
                            <i class="fas fa-eye-slash" aria-hidden="true"></i>
                            <span class="visually-hidden">Mask Widget</span>
                        </button>
                        <button id="notes-widget-btn" class="widget-selector-btn" data-widget="notes" type="button" aria-label="Notes widget">
                            <i class="fas fa-note-sticky" aria-hidden="true"></i>
                            <span class="visually-hidden">Notes Widget</span>
                        </button>
                    </div>
                </div>
                <div id="widgets-container" class="widgets-grid">
                    <!-- Widgets are dynamically added here by JavaScript -->
                    <div class="widget-placeholder">
                        <p>Add your first widget from the Teacher Controls!</p>
                    </div>
                </div>

                <section class="drawing-board">
                    <h2>Drawing Board</h2>
                    <div class="drawing-controls" aria-label="Drawing controls">
                        <div class="control-row">
                            <span class="control-label">Color:</span>
                            <div class="control-buttons" role="group" aria-label="Drawing colors">
                                <button id="color-black" class="color-btn selected" type="button">Black</button>
                                <button id="color-red" class="color-btn" type="button">Red</button>
                                <button id="color-green" class="color-btn" type="button">Green</button>
                            </div>
                        </div>
                        <div class="control-row">
                            <span class="control-label">Size:</span>
                            <div class="control-buttons" role="group" aria-label="Brush sizes">
                                <button id="size-small" class="size-btn" type="button">S</button>
                                <button id="size-medium" class="size-btn selected" type="button">M</button>
                                <button id="size-large" class="size-btn" type="button">L</button>
                            </div>
                        </div>
                        <div class="control-row control-actions">
                            <button id="clear-drawing-btn" type="button">Clear Drawing</button>
                            <button id="save-drawing-btn" type="button">Save Image</button>
                        </div>
                    </div>
                    <canvas id="drawing-canvas" aria-label="Canvas for drawing"></canvas>
                </section>
            </main>
        </section>

        <!-- =====================================================
             OTHER VIEWS (Placeholders)
             ===================================================== -->
        <section id="reminders-view" class="view" role="tabpanel" aria-labelledby="reminders-tab" hidden>
            <div class="placeholder-content">Reminders content coming soon</div>
        </section>
        <section id="planner-view" class="view" role="tabpanel" aria-labelledby="planner-tab" hidden>
            <div class="placeholder-content">Planner content coming soon</div>
        </section>
        <section id="timetable-view" class="view" role="tabpanel" aria-labelledby="timetable-tab" hidden>
            <div class="placeholder-content">Timetable content coming soon</div>
        </section>
        <section id="notes-view" class="view" role="tabpanel" aria-labelledby="notes-tab" hidden>
            <div class="notes-panel">
                <header class="notes-panel__header">
                    <div>
                        <h2>Saved Notes</h2>
                        <p>Notes you save from the Notes widget will appear here for quick access.</p>
                    </div>
                    <span class="notes-panel__hint">Switch to the Classroom tab to edit notes.</span>
                </header>
                <div id="saved-notes-list" class="saved-notes-list" role="list">
                    <p id="saved-notes-empty" class="notes-empty">No saved notes yet. Open the Notes widget and save a note to see it here.</p>
                </div>
            </div>
        </section>

        <!-- =====================================================
             TEACHER CONTROLS PANEL (REDESIGNED)
             ===================================================== -->
        <aside class="teacher-panel" id="teacher-panel" role="complementary" aria-label="Teacher controls">
            <header class="panel-header">
                <h3>Teacher Controls</h3>
                <button id="close-teacher-panel" class="panel-close" aria-label="Close Teacher Controls">&times;</button>
            </header>
            <div class="panel-content">
                <!-- Control Cards -->
                <section class="control-card">
                    <details open>
                        <summary role="button" tabindex="0">
                            <img src="assets/icons/widget.svg" alt="" class="card-icon">
                            <h4>Add Widget</h4>
                        </summary>
                        <div class="card-body">
                            <p>Use the floating action button (+) to add widgets.</p>
                        </div>
                    </details>
                </section>
                <section class="control-card">
                    <details>
                        <summary role="button" tabindex="0">
                            <img src="assets/icons/name-picker.svg" alt="" class="card-icon">
                            <h4>Student List</h4>
                        </summary>
                        <div class="card-body">
                            <ul id="student-list-display" class="student-list-display"></ul>
                            <div class="button-group" style="margin-top: 10px;">
                                <button id="export-students-btn" class="control-button">Export Students</button>
                                <button id="import-students-btn" class="control-button">Import Students</button>
                            </div>
                            <input type="file" id="file-input" accept=".txt" style="display: none;">
                        </div>
                    </details>
                </section>
                <section class="control-card">
                    <details>
                        <summary role="button" tabindex="0">
                            <img src="assets/icons/timer.svg" alt="" class="card-icon">
                            <h4>Timer Control</h4>
                        </summary>
                        <div class="card-body">
                            <div class="control-group timer-inputs">
                                <input type="number" id="timer-hours" min="0" placeholder="HH" value="0">
                                <span>:</span>
                                <input type="number" id="timer-minutes" min="0" max="59" placeholder="MM" value="5">
                                <span>:</span>
                                <input type="number" id="timer-seconds" min="0" max="59" placeholder="SS" value="0">
                            </div>
                            <div class="button-group">
                                <button id="start-timer" class="control-button">Start Timer</button>
                                <button id="stop-timer" class="control-button">Stop Timer</button>
                            </div>
                            <div class="button-group" style="margin-top: 10px;">
                                <button id="timer-preset-5" class="timer-preset-btn control-button">5 min</button>
                                <button id="timer-preset-10" class="timer-preset-btn control-button">10 min</button>
                                <button id="timer-preset-15" class="timer-preset-btn control-button">15 min</button>
                            </div>
                        </div>
                    </details>
                </section>
                <section class="control-card">
                    <details>
                        <summary role="button" tabindex="0">
                            <img src="assets/icons/theme.svg" alt="" class="card-icon">
                            <h4>Theme</h4>
                        </summary>
                        <div class="card-body">
                            <div class="theme-selector" id="theme-selector">
                                <!-- Radio buttons will be populated by JS -->
                            </div>
                            <div class="input-group">
                                <label style="display: flex; align-items: center; gap: 10px; margin-top: 10px; cursor: pointer;">
                                    <input type="checkbox" id="reduce-motion-toggle">
                                    Reduce Motion (limit animations)
                                </label>
                            </div>
                        </div>
                    </details>
                </section>
                <section class="control-card">
                    <details>
                        <summary role="button" tabindex="0">
                            <img src="assets/icons/background.svg" alt="" class="card-icon">
                            <h4>Background</h4>
                        </summary>
                        <div class="card-body">
                            <div id="background-selector" class="background-selector">
                                <!-- Background swatches will be populated by JS -->
                            </div>
                        </div>
                    </details>
                </section>
                <section class="control-card">
                    <details>
                        <summary role="button" tabindex="0">
                            <img src="assets/icons/preset.svg" alt="" class="card-icon">
                            <h4>Layouts &amp; Presets</h4>
                        </summary>
                        <div class="card-body">
                            <div class="input-group">
                                <label for="layout-preset">Quick Layout</label>
                                <select id="layout-preset">
                                    <option value="">None</option>
                                    <option value="2x2">2Ã—2 Grid</option>
                                    <option value="full-timer">Full-width Timer</option>
                                </select>
                                <button id="apply-layout-preset" class="control-button">Apply</button>
                            </div>
                            <div class="input-group">
                                <label for="preset-name">Preset Name</label>
                                <input type="text" id="preset-name" placeholder="e.g., Morning Routine">
                            </div>
                            <div class="input-group">
                                <label for="preset-class-name">Class Name (optional)</label>
                                <input type="text" id="preset-class-name" placeholder="e.g., 8A Maths">
                            </div>
                            <div class="input-group">
                                <label for="preset-period">Period / Time Slot (optional)</label>
                                <input type="text" id="preset-period" placeholder="e.g., Morning, Afternoon">
                            </div>
                            <div class="button-group">
                                <button id="save-preset" class="control-button">Save / Overwrite</button>
                                <button id="reset-layout" class="control-button">Reset Layout</button>
                            </div>
                            <div class="button-group">
                                <button id="export-layout" class="control-button">Export</button>
                                <button id="import-layout" class="control-button">Import</button>
                            </div>
                            <div class="preset-filters">
                                <input type="text" id="preset-class-filter" placeholder="Filter by class name">
                                <select id="preset-period-filter">
                                    <option value="">All periods</option>
                                    <option value="Morning">Morning</option>
                                    <option value="Afternoon">Afternoon</option>
                                </select>
                            </div>
                            <div id="preset-list" class="preset-list" aria-live="polite"></div>
                        </div>
                    </details>
                </section>
                <section class="control-card">
                    <details>
                        <summary role="button" tabindex="0">
                            <img src="assets/icons/lesson-plan.svg" alt="" class="card-icon">
                            <h4>Lesson Plan</h4>
                        </summary>
                        <div class="card-body">
                            <div id="lesson-plan-editor"></div>
                        </div>
                    </details>
                </section>
            </div>
        </div>
        <div class="panel-backdrop"></div>

        <!-- =====================================================
             GLOBAL CONTROLS (REDESIGNED)
             ===================================================== -->
        <button id="fab" class="fab" aria-label="Add widget">+</button>

        <dialog id="widget-modal" aria-labelledby="widget-modal-title">
            <div class="modal-header">
                <h3 id="widget-modal-title">Add a Widget</h3>
                <button class="modal-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="widget-categories">
                    <!-- Categories and widgets will be populated by JS -->
                </div>
            </div>
        </dialog>

        <dialog id="name-entry-dialog" aria-labelledby="name-entry-title">
            <div class="modal-header">
                <h3 id="name-entry-title">Add Item</h3>
                <button class="modal-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <label for="name-entry-input" class="visually-hidden">Name</label>
                <input id="name-entry-input" type="text" name="name-entry" placeholder="Enter a name" autocomplete="off">
            </div>
            <div class="modal-actions">
                <button class="control-button modal-primary" id="name-entry-confirm">Add</button>
                <button class="control-button" data-close>Cancel</button>
            </div>
        </dialog>

        <dialog id="help-dialog" aria-labelledby="help-dialog-title">
            <div class="modal-header">
                <h3 id="help-dialog-title">How to Use Teacher Controls</h3>
                <button class="modal-close" aria-label="Close Help">&times;</button>
            </div>
            <div class="modal-body">
                <ul>
                    <li>Use the navigation bar to switch between views.</li>
                    <li>Use the floating action button (+) to add widgets.</li>
                    <li>All changes save automatically to your browser.</li>
                </ul>
            </div>
            <div class="modal-actions">
                <button class="control-button modal-primary" data-close>Got it</button>
            </div>
        </dialog>

        <dialog id="tour-dialog" aria-labelledby="tour-dialog-title">
            <div class="modal-header">
                <h3 id="tour-dialog-title">Welcome to Your New Classroom Screen</h3>
                <button class="modal-close" aria-label="Close Tour">&times;</button>
            </div>
            <div class="modal-body">
                <p>Take a quick tour of the new layout:</p>
                <ol>
                    <li><strong>Top Navigation</strong>: Switch between the Classroom, Dashboard, and other tools.</li>
                    <li><strong>Teacher Panel</strong>: Access all controls from the slide-out panel on the right.</li>
                    <li><strong>Floating Action Button</strong>: Use the "+" button to add new widgets to the screen.</li>
                </ol>
            </div>
            <div class="modal-actions">
                <button class="control-button modal-primary" data-close>Start Teaching</button>
            </div>
        </dialog>

        <dialog id="import-dialog" aria-labelledby="import-dialog-title">
            <div class="modal-header">
                <h3 id="import-dialog-title">Import Layout & Presets</h3>
                <button class="modal-close" aria-label="Close Import">&times;</button>
            </div>
            <div class="modal-body">
                <p>Paste a layout + presets JSON below:</p>
                <textarea id="import-json-input" rows="8"></textarea>
                <div id="import-summary" class="import-summary"></div>
            </div>
            <div class="modal-actions">
                <button class="control-button modal-primary" id="confirm-import">Import</button>
                <button class="control-button" data-close>Cancel</button>
            </div>
        </dialog>

        <div id="live-region" aria-live="polite" aria-atomic="true" class="visually-hidden"></div>
    </main>

    <!-- =====================================================
         JAVASCRIPT FILES
         ===================================================== -->
    <!-- Using 'defer' ensures scripts run after HTML is parsed, in order -->
    <script src="js/utils/layout-manager.js" defer></script>
    <script src="js/utils/background-manager.js" defer></script>
    <script src="assets/sounds/sound-data.js" defer></script>
    <script src="js/widgets/timer.js" defer></script>
    <script src="js/widgets/noise-meter.js" defer></script>
    <script src="js/widgets/noise-meter-widget.js" defer></script>
    <script src="js/widgets/name-picker.js" defer></script>
    <script src="js/widgets/qr-code-widget.js" defer></script>
    <script src="js/widgets/drawing-tool.js" defer></script>
    <script src="js/widgets/document-viewer.js" defer></script>
    <script src="js/widgets/mask-widget.js" defer></script>
    <script src="js/widgets/notes-widget.js" defer></script>
    <script src="js/script.js" defer></script>
    <script src="js/main.js" defer></script>

    <!-- Widget Settings Modal Overlay -->
    <div id="widget-settings-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" aria-label="Close Settings">&times;</button>
            <div class="modal-header">
                <h3 class="modal-title">Settings</h3>
            </div>
            <div class="modal-body">
                <!-- Widget controls will be injected here -->
            </div>
        </div>
    </div>

    <!-- Main Menu Modal Overlay -->
    <div id="main-menu-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="main-menu-title">
        <div class="modal-content">
            <button class="modal-close-btn" aria-label="Close Main Menu">&times;</button>
            <div class="modal-header">
                <h3 id="main-menu-title" class="modal-title">Main Menu</h3>
            </div>
            <div class="modal-body">
                <h2>Lesson Layouts</h2>
                <div class="button-group" style="justify-content: flex-start; gap: 12px;">
                    <button id="open-planner-btn" class="control-button">
                        <i class="fas fa-calendar-week" aria-hidden="true"></i>
                        <span>Planner</span>
                    </button>
                    <button id="load-todays-lesson-btn" class="control-button modal-primary">
                        <i class="fas fa-play" aria-hidden="true"></i>
                        <span>Load Today's Lesson</span>
                    </button>
                    <button id="open-agenda-btn" class="control-button">
                        <i class="fas fa-list-check" aria-hidden="true"></i>
                        <span>Today's Agenda</span>
                    </button>
                </div>
                <div class="layout-input-row">
                    <input type="text" id="layout-name-input" placeholder="New layout name..." aria-label="Layout name">
                    <button id="save-layout-btn" class="control-button">Save Current Layout</button>
                </div>
                <div id="saved-layouts-list" class="saved-layouts-list" aria-live="polite"></div>
            </div>
        </div>
    </div>

    <!-- Planner Modal Overlay -->
    <div id="planner-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="planner-modal-title">
        <div class="modal-content">
            <button class="modal-close-btn" aria-label="Close Planner">&times;</button>
            <div class="modal-header">
                <h3 id="planner-modal-title" class="modal-title">Weekly Planner</h3>
            </div>
            <div class="modal-body">
                <p>Click a time slot to assign a saved layout. Changes are stored locally.</p>
                <div id="planner-calendar-grid"></div>
            </div>
        </div>
    </div>

    <!-- Agenda Modal Overlay -->
    <div id="agenda-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="agenda-modal-title">
        <div class="modal-content">
            <button class="modal-close-btn" aria-label="Close Agenda">&times;</button>
            <div class="modal-header">
                <h3 id="agenda-modal-title" class="modal-title">Today's Agenda</h3>
            </div>
            <div class="modal-body">
                <div id="agenda-list" class="agenda-list"></div>
            </div>
        </div>
    </div>

</body>
</html>
